# Focus Blocker - Подробная документация

## Обзор

Focus Blocker - это расширение для браузера, предназначенное для предотвращения обнаружения веб-сайтами переключения вкладок, потери фокуса или изменения видимости страницы. Это расширение перехватывает и блокирует события, связанные с фокусом, и события изменения видимости на всех веб-сайтах, предоставляя пользователям большую приватность и контроль над их опытом просмотра.

## Возможности

### Основной функционал

1. **Блокировка событий**
   - Блокирует события `focus`, `blur`, `focusin` и `focusout`
   - Блокирует события `visibilitychange` (включая варианты для разных браузеров: `webkitvisibilitychange`, `mozvisibilitychange`, `msvisibilitychange`)
   - Предотвращает обнаружение сайтами переключения вкладок или изменения фокуса окна
   - Перехватывает как обработчики событий, так и встроенные обработчики

2. **Черный список доменов**
   - Настройка доменов, где расширение должно быть отключено
   - Поддержка шаблонов с подстановочными знаками (например, `*.example.com`)
   - Автоматическое сопоставление поддоменов
   - Полезно для сайтов, которым требуется обнаружение фокуса для правильной работы

3. **Copy Helper**
   - Визуальное выделение элементов при удержании Ctrl/Cmd
   - Быстрое копирование текста с помощью Ctrl/Cmd + Alt
   - Настраиваемый цвет и прозрачность рамки
   - Помогает копировать текст с сайтов, которые запрещают обычное выделение

4. **Глобальное переключение**
   - Быстрое включение/выключение из интерфейса всплывающего окна
   - Индикатор статуса показывает текущее состояние
   - Отображает информацию о текущем домене

## Технические детали

### Архитектура

Расширение состоит из нескольких компонентов:

- **Content Scripts**: Работают в контексте страницы для перехвата и блокировки событий
- **Settings Bridge**: Обеспечивает связь настроек между расширением и контекстом страницы
- **Popup Interface**: Предоставляет элементы управления пользователем и отображение статуса
- **Options Page**: Полный интерфейс настройки параметров

### Перехват событий

Расширение использует несколько техник для блокировки событий:

1. **Переопределение прототипа**: Переопределяет `EventTarget.prototype.addEventListener` и `removeEventListener` для предотвращения регистрации заблокированных событий
2. **Блокировка отправки событий**: Перехватывает `dispatchEvent` для предотвращения ручной отправки событий
3. **Переопределение свойств**: Переопределяет свойства документа, связанные с видимостью (`hidden`, `visibilityState` и т.д.)
4. **Установка обработчиков**: Устанавливает обработчики событий на фазе захвата для остановки распространения событий

### Хранение настроек

Все настройки хранятся в `chrome.storage.sync`, что позволяет синхронизировать их между устройствами при входе в Chrome.

## Конфигурация

### Блокируемые события

Вы можете настроить, какие события блокировать на странице настроек:
- `visibilitychange` - Стандартное событие изменения видимости
- `webkitvisibilitychange` - Вариант для WebKit
- `mozvisibilitychange` - Вариант для Mozilla
- `msvisibilitychange` - Вариант для Microsoft
- `blur` - Событие потери фокуса окна
- `focus` - Событие получения фокуса окна
- `focusin` - Событие входа фокуса
- `focusout` - Событие выхода фокуса

### Черный список доменов

Добавьте домены, где расширение не должно работать. Формат:
- Один домен на строку
- Поддержка подстановочных знаков: `*.example.com`
- Автоматическое сопоставление поддоменов: `example.com` соответствует `www.example.com`

### Настройки Copy Helper

- **Включить выделение**: Показывать визуальную рамку при наведении с нажатым Ctrl/Cmd
- **Цвет рамки**: Настроить цвет рамки выделения
- **Прозрачность рамки**: Настроить видимость рамки выделения

## Случаи использования

1. **Приватность**: Предотвращение отслеживания сайтами переключения вкладок
2. **Продуктивность**: Избежание прерываний от сайтов, которые приостанавливаются при переключении вкладок
3. **Тестирование**: Проверка поведения сайтов без обнаружения фокуса
4. **Доступность**: Помощь в копировании текста с сайтов с ограниченным выделением

## Совместимость с браузерами

Разработано для браузеров на базе Chromium (Chrome, Edge, Brave и т.д.) с использованием Manifest V3.

## Разработка

### Структура проекта

```
focus-blocker-main/
├── manifest.json          # Манифест расширения
├── assets/                # Иконки и изображения
├── public/                # HTML интерфейсы
│   ├── popup.html        # Интерфейс всплывающего окна
│   └── options.html      # Страница настроек
└── src/                   # Исходные файлы JavaScript
    ├── content.js        # Основной content script
    ├── settings-bridge.js # Связь настроек
    ├── copy-helper.js    # Функциональность Copy Helper
    ├── popup.js          # Логика всплывающего окна
    └── options.js        # Логика страницы настроек
```

### Сборка

Процесс сборки не требуется. Расширение можно загрузить напрямую из исходной директории.

## Лицензия

Unlicense - Это свободное и неограниченное программное обеспечение, выпущенное в общественное достояние.

## Поддержка

По вопросам, проблемам или вкладу в проект, пожалуйста, посетите [репозиторий GitHub](https://github.com/The-Open-Tech-Company/focus-block-browser).
